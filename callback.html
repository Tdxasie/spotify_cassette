<!DOCTYPE html>
<html>

<head>
	<title>Spotify Callback</title>
</head>

<body>
	<script>
		const CLIENT_ID = 'YOUR_SPOTIFY_CLIENT_ID';
		const REDIRECT_URI = 'http://127.0.0.1:5500/callback.html';

		const code = new URLSearchParams(window.location.search).get('code');
		const codeVerifier = localStorage.getItem('code_verifier');

		if (!code) {
			document.body.innerHTML = '<p style="color:red;">No auth code found. Try again.</p>';
			throw new Error("Missing auth code.");
		}

		async function getToken() {
			const body = new URLSearchParams({
				client_id: CLIENT_ID,
				grant_type: 'authorization_code',
				code,
				redirect_uri: REDIRECT_URI,
				code_verifier: codeVerifier
			});

			const res = await fetch('https://accounts.spotify.com/api/token', {
				method: 'POST',
				headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
				body
			});

			const data = await res.json();
			if (data.access_token) {
				localStorage.setItem('spotify_token', data.access_token);
				window.location.href = 'playlists.html';
			} else {
				document.body.innerHTML = '<p style="color:red;">Token exchange failed.</p>';
				console.error(data);
			}
		}

		getToken();
	</script>
</body>

</html>